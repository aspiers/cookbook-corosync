# DO NOT EDIT!

# This file is automatically configured via Chef on <%= node["fqdn"] %>

# Please read the corosync.conf.5 manual page

service {
        ver:            1
        name:           pacemaker
}

totem {
        version:        2

        cluster_name:   <%= @cluster_name %>

        # How long before declaring a token lost (ms)
        token: 3000

        # How many token retransmits before forming a new configuration
        token_retransmits_before_loss_const: 10

        # How long to wait for join messages in the membership protocol (ms)
        join: 60

        # How long to wait for consensus to be achieved before starting a new round of membership configuration (ms)
        consensus: 5000

        # Turn off the virtual synchrony filter
        vsftype: none

        # Number of messages that may be sent by one processor on receipt of the token
        max_messages: 20

        # Limit generated nodeids to 31-bits (positive signed integers)
        clear_node_high_bit: yes

        secauth: on

        crypto_cipher:  none
        crypto_hash:    none
        # How many threads to use for encryption/decryption
        threads: 0

        # This specifies the mode of redundant ring, which may be none, active, or passive.
        rrp_mode: none

        interface {
                ringnumber:     0
                bindnetaddr:    <%= @bind_addr  %>
                mcastaddr:      <%= @mcast_addr %>
                mcastport:      <%= @mcast_port %>
                ttl:            1
        }
}

quorum {
        # Enable and configure quorum subsystem (default: off)
        # see also corosync.conf.5 and votequorum.5
        provider: corosync_votequorum
        expected_votes: 1
}

amf {
        mode: disabled
}

aisexec {
        user:   root
        group:  root
}

logging {
        fileline:       off
        to_stderr:      no
        to_logfile:     yes
        logfile:        <%= @log_file %>
        to_syslog:      yes
        syslog_facility: daemon
        debug:          off
        timestamp:      on
        logger_subsys {
                # FIXME: which do we want here?
                #subsys: QUORUM
                subsys: AMF
                debug:  off
                tags: enter|leave|trace1|trace2|trace3|trace4|trace6
        }
}
